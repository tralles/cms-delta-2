language: ruby
rvm:
- 2.0
- 2.1
- 2.2
- jruby-9.0.0.0
- jruby
- rbx-2

env:
- "SUITE=units       DB=postgresql"
  # https://github.com/jruby/jruby/issues/779
- rvm: jruby  
  before_install:
   # https://github.com/travis-ci/travis-ci/issues/4720
  - if [[ ${TRAVIS_RUBY_VERSION} =~ jruby-9\.0 ]] ;
    then
       rvm get master ;
       rvm use ${TRAVIS_RUBY_VERSION} --install ;
       ruby --version ;
     fi
  - "sudo apt-get update -qq"
  - "sudo apt-get --no-install-recommends install bzr cvs git mercurial subversion"

script:
   - cd cms
   - "RUN_ON_NOT_OFFICIAL='' RUBY_VER=1.9 BRANCH=trunk bundle exec rails c config/database.yml"
   - "bundle install"
   - export TEST_SUITE=${SUITE}
   - "JRUBY_OPTS=-J-Xmx1024m bundle exec rails c"
   - JRUBY_OPTS='-J-Xmx1024m -J-XX:MaxPermSize=1024m' bundle exec rails c
   - exec rails c
notifications:
   email: false
